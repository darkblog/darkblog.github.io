<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description | strip_html | normalize_whitespace | truncate: 160 }}{% else %}{{ page.excerpt | strip_html | normalize_whitespace | truncate: 160 }}{% endif %}">
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    <link href="https://www.pasgah.org/blog.xml" rel="alternate" type="application/atom+xml">
    <link rel="icon" href="https://www.pasgah.org/blog.svg" type="image/svg+xml">
    <meta property="og:updated_time" content="{{ site.time | date_to_xmlschema }}">
    <meta property="article:published_time" content="{{ site.time | date_to_xmlschema }}">
    <meta property="article:modified_time" content="{{ site.time | date_to_xmlschema }}">
    <meta name="theme-color" content="black">
    
    <style>
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://www.pasgah.org/blog.woff2') format('woff2-variations');
            font-weight: 100 900;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --radius: 0.75rem;
            --max-width: 56.25rem;
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: white;
            color: black;
            line-height: 1.7;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-weight: 400;
        }
        
        .hero-section {
            background: white;
            min-height: clamp(25rem, 50vh, 31.25rem);
            margin-bottom: clamp(2rem, 5vh, 3.75rem);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: black;
            position: relative;
            overflow: hidden;
        }
        
        .hero-content {
            max-width: min(90vw, var(--max-width));
            padding: clamp(2.5rem, 6vh, 3.75rem) clamp(1rem, 3vw, 1.25rem);
            position: relative;
            z-index: 2;
        }
        
        .site-logo {
            height: clamp(4rem, 10vw, 5rem);
            width: clamp(4rem, 10vw, 5rem);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto clamp(1.5rem, 4vh, 2.5rem) auto;
        }
        
        .site-logo img {
            width: clamp(3.25rem, 8.5vw, 4.25rem);
            height: clamp(3.25rem, 8.5vw, 4.25rem);
            object-fit: contain;
        }
        
        .post-title-main {
            font-size: clamp(2rem, 6vw, 3rem);
            margin-bottom: clamp(1rem, 3vh, 1.25rem);
            color: black;
            position: relative;
            padding-bottom: clamp(0.75rem, 2vh, 1.25rem);
            font-weight: 900;
            line-height: 1.3;
        }
        
        main {
            flex: 1;
            margin: 0 auto clamp(1.5rem, 4vh, 2.5rem);
            padding: 0 clamp(1rem, 3vw, 1.25rem);
            width: 100%;
            max-width: var(--max-width);
            z-index: 100;
        }
        
        .post-content-container {
            background: white;
            border-radius: var(--radius);
            padding: clamp(1.5rem, 4vw, 2.5rem);
            margin-bottom: clamp(1.5rem, 4vh, 2.5rem);
            border: 1px solid black;
        }
        
        .post-content {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            line-height: 1.9;
            color: black;
            font-weight: 400;
        }
        
        .post-content p {
            margin: clamp(1rem, 2.5vh, 1.5rem) 0;
        }
        
        .post-content img {
            max-width: 100%;
            height: auto;
            margin: clamp(1.5rem, 3vh, 1.875rem) auto;
            display: block;
            border-radius: var(--radius);
            object-fit: contain;
            background-color: white;
        }
        
        .post-content figure {
            margin: clamp(1.5rem, 3vh, 1.875rem) 0;
            text-align: center;
        }
        
        .post-content figcaption {
            font-size: clamp(0.85rem, 2vw, 0.9rem);
            color: black;
            margin-top: clamp(0.5rem, 1.5vh, 0.75rem);
            font-style: italic;
            line-height: 1.5;
            opacity: 0.8;
            font-weight: 300;
        }
        
        .post-content blockquote {
            border-right: 0.25rem solid black;
            padding: clamp(1.25rem, 3vh, 1.5rem) clamp(1.5rem, 3vh, 1.875rem);
            margin: clamp(1.75rem, 4vh, 2.1875rem) 0;
            background: white;
            font-style: normal;
            color: black;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            position: relative;
            border-radius: var(--radius);
            font-weight: 400;
        }
        
        .post-content blockquote::before {
            content: "“";
            font-size: clamp(2.5rem, 6vh, 4rem);
            color: black;
            position: absolute;
            top: clamp(0.5rem, 1.5vh, 0.625rem);
            right: clamp(1rem, 2.5vh, 1.25rem);
            opacity: 0.3;
            font-weight: 300;
        }
        
        .post-content h1, .post-content h2, .post-content h3 {
            margin: clamp(1.5rem, 4vh, 2.5rem) 0 clamp(1rem, 2.5vh, 1.5rem);
            color: black;
            padding: 0;
            line-height: 1.3;
        }
        
        .post-content h1 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-top: 0;
            color: black;
            font-weight: 800;
        }
        
        .post-content h2 {
            font-size: clamp(1.3rem, 3.5vw, 1.7rem);
            padding-bottom: clamp(0.5rem, 1.5vh, 0.625rem);
            position: relative;
            font-weight: 700;
        }
        
        .post-content h3 {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            font-weight: 600;
        }
        
        .post-content a {
            color: black;
            text-decoration: none;
            font-weight: 500;
        }
        
        .post-content ol, .post-content ul {
            margin: clamp(1rem, 2.5vh, 1.5rem) 0;
            padding-right: clamp(1.25rem, 3vh, 1.875rem);
        }
        
        .post-content li {
            margin-bottom: clamp(0.5rem, 1.5vh, 0.75rem);
        }
        
        .post-content code {
            background-color: white;
            border-radius: 0.375rem;
            padding: 0.1875rem 0.5rem;
            font-family: Monaco, Consolas, monospace;
            font-size: clamp(0.85rem, 2vw, 0.9rem);
            color: black;
            border: 1px solid black;
            font-weight: 400;
        }
        
        .post-content ul {
            list-style: none;
            padding-right: clamp(1.25rem, 3vh, 1.875rem);
        }
        
        .post-content ul li {
            position: relative;
            margin-bottom: clamp(0.5rem, 1.5vh, 0.75rem);
            padding-right: clamp(1rem, 2.5vh, 1.25rem);
        }
        
        .post-content ul li::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0.75em;
            width: clamp(0.375rem, 1vw, 0.5rem);
            height: clamp(0.375rem, 1vw, 0.5rem);
            background-color: black;
            border-radius: 50%;
        }
        
        .post-content ol {
            list-style: none;
            counter-reset: list-counter;
            padding-right: clamp(1.25rem, 3vh, 1.875rem);
        }
        
        .post-content ol li {
            position: relative;
            margin-bottom: clamp(0.5rem, 1.5vh, 0.75rem);
            padding-right: clamp(1.25rem, 3vh, 1.875rem);
            counter-increment: list-counter;
        }
        
        .post-content ol li::before {
            content: counter(list-counter) ". ";
            position: absolute;
            right: 0;
            color: black;
            font-weight: 600;
        }
        
        .post-content table {
            width: 100%;
            border-collapse: collapse;
            margin: clamp(1.5rem, 3vh, 1.875rem) 0;
            font-size: clamp(0.9rem, 2.2vw, 1rem);
        }
        
        .post-content table thead {
            background-color: black;
            color: white;
            font-weight: 600;
        }
        
        .post-content table th {
            padding: clamp(0.75rem, 2vh, 1rem) clamp(0.75rem, 2vh, 1rem);
            text-align: right;
            font-weight: 600;
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            border: 1px solid black;
        }
        
        .post-content table td {
            padding: clamp(0.75rem, 2vh, 1rem);
            text-align: right;
            border: 1px solid black;
            vertical-align: top;
            font-weight: 400;
        }
        
        .post-content table tbody tr {
            transition: background-color 0.2s ease;
        }
        
        .post-content table tbody tr:nth-child(even) {
            background-color: white;
        }
        
        .post-content ul ul,
        .post-content ol ol {
            margin-top: clamp(0.5rem, 1.5vh, 0.625rem);
            margin-bottom: clamp(0.5rem, 1.5vh, 0.625rem);
        }
        
        .post-content ul ul li::before {
            width: clamp(0.25rem, 0.8vw, 0.375rem);
            height: clamp(0.25rem, 0.8vw, 0.375rem);
            background-color: black;
        }
        
        .post-content ol ol li::before {
            color: black;
        }
        
        .related-posts {
            margin-top: 0;
            padding-top: 0;
        }
        
        .posts-container {
            display: grid;
            gap: clamp(1.5rem, 4vh, 2.5rem);
        }
        
        .post-card {
            position: relative;
            overflow: hidden;
            border: 1px solid black;
            background: white;
            border-radius: var(--radius);
            padding: clamp(1.5rem, 4vw, 2.5rem);
        }
        
        .post-card-title {
            font-size: clamp(1.1rem, 3vw, 1.5rem);
            margin-bottom: clamp(1rem, 2.5vh, 1.25rem);
            color: black;
            font-weight: 700;
            line-height: 1.4;
        }
        
        .post-card-title a {
            color: inherit;
            text-decoration: none;
            display: block;
        }
        
        .post-card-description {
            color: black;
            line-height: 1.6;
            font-size: clamp(0.85rem, 2.2vw, 0.95rem);
            margin-bottom: 0;
            opacity: 0.8;
            font-weight: 400;
        }
        
        .post-card-link {
            text-decoration: none;
            color: inherit;
            display: block;
            -webkit-tap-highlight-color: transparent;
        }
        
        .load-more-container {
            text-align: center;
            margin-top: clamp(1.5rem, 4vh, 2.5rem);
        }
        
        .load-more-btn {
            padding: clamp(0.75rem, 2.5vh, 0.9375rem) clamp(1.5rem, 4vw, 2.5rem);
            background: black;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-family: 'Vazirmatn', sans-serif;
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            font-weight: 600;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .post-content table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .post-content table th,
            .post-content table td {
                white-space: nowrap;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <section class="hero-section">
        <div class="hero-content">
            <a href="https://www.pasgah.org/" class="site-logo">
                <img src="https://www.pasgah.org/blog.svg" loading="lazy" alt="وبلاگ پاسگاه">
            </a>
            
            <h1 class="post-title-main">{{ page.title }}</h1>
        </div>
    </section>
    
    <main>
        <div class="post-content-container">
            <article class="post-content">
                {{ content }}
            </article>
        </div>
        
        <section class="related-posts">
            <div class="posts-container" id="relatedPostsContainer">
                {% assign current_post_url = page.url %}
                {% assign all_posts = site.posts | where_exp: "post", "post.url != current_post_url" %}
                
                {% for post in all_posts %}
                <article class="post-card">
                    <a href="{{ post.url }}" class="post-card-link">
                        <h3 class="post-card-title">{{ post.title }}</h3>
                        {% if post.description %}
                        <div class="post-card-description">{{ post.description }}</div>
                        {% elsif post.excerpt %}
                        <div class="post-card-description">{{ post.excerpt | strip_html | truncate: 200 }}</div>
                        {% endif %}
                    </a>
                </article>
                {% endfor %}
            </div>
            
            <div class="load-more-container" id="loadMoreContainer" style="display: none;">
                <button class="load-more-btn" id="loadMoreBtn">نمایش مطالب بیشتر</button>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const relatedPostsContainer = document.getElementById('relatedPostsContainer');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const allRelatedPosts = relatedPostsContainer.querySelectorAll('.post-card');
            const postsPerPage = 10;
            let currentVisibleCount = postsPerPage;
            
            function hideExtraPosts() {
                allRelatedPosts.forEach((post, index) => {
                    if (index >= currentVisibleCount) {
                        post.style.display = 'none';
                    } else {
                        post.style.display = 'block';
                    }
                });
            }
            
            function showMorePosts() {
                currentVisibleCount += postsPerPage;
                
                allRelatedPosts.forEach((post, index) => {
                    if (index < currentVisibleCount) {
                        post.style.display = 'block';
                    }
                });
                
                if (currentVisibleCount >= allRelatedPosts.length) {
                    loadMoreContainer.style.display = 'none';
                }
                
                updateButtonText();
            }
            
            function updateButtonText() {
                const remainingPosts = allRelatedPosts.length - currentVisibleCount;
                if (remainingPosts > 0) {
                    loadMoreBtn.textContent = `نمایش ${Math.min(remainingPosts, postsPerPage)} مطلب دیگر (${remainingPosts} مطلب باقی‌مانده)`;
                } else {
                    loadMoreBtn.textContent = 'همه مطالب نمایش داده شدند';
                    setTimeout(() => {
                        loadMoreContainer.style.display = 'none';
                    }, 2000);
                }
            }
            
            if (allRelatedPosts.length > postsPerPage) {
                loadMoreContainer.style.display = 'block';
                hideExtraPosts();
                updateButtonText();
            } else if (allRelatedPosts.length > 0) {
                hideExtraPosts();
                loadMoreContainer.style.display = 'none';
            } else {
                document.querySelector('.related-posts').style.display = 'none';
            }
            
            loadMoreBtn.addEventListener('click', showMorePosts);
            
            function saveState() {
                localStorage.setItem('relatedPostsVisibleCount', currentVisibleCount.toString());
            }
            
            function loadState() {
                const savedCount = localStorage.getItem('relatedPostsVisibleCount');
                if (savedCount) {
                    const parsedCount = parseInt(savedCount);
                    if (parsedCount > postsPerPage && parsedCount <= allRelatedPosts.length) {
                        currentVisibleCount = parsedCount;
                        hideExtraPosts();
                        updateButtonText();
                    }
                }
            }
            
            loadState();
            
            loadMoreBtn.addEventListener('click', saveState);
            
            window.addEventListener('beforeunload', saveState);
            
            localStorage.setItem('currentPostUrl', window.location.pathname);
            
            const savedPostUrl = localStorage.getItem('savedPostUrl');
            if (savedPostUrl && savedPostUrl !== window.location.pathname) {
                localStorage.removeItem('relatedPostsVisibleCount');
            }
            localStorage.setItem('savedPostUrl', window.location.pathname);
        });
    </script>
</body>
</html>
